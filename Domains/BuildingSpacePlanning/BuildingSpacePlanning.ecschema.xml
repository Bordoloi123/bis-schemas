<?xml version="1.0" encoding="UTF-8"?>
<!-- =====================================================================================
|
|     $Source: BuildingSpacePlanning.ecschema.xml $
|
|  $Copyright: (c) 2018 Bentley Systems, Incorporated. All rights reserved. $
|
======================================================================================= -->
<ECSchema schemaName="BuildingSpacePlanning" nameSpacePrefix="bsp" version="01.00" xmlns="http://www.bentley.com/schemas/Bentley.ECXML.3.0">
    <ECSchemaReference name="Bentley_Standard_CustomAttributes" version="01.10" prefix="bsca" />
    <ECSchemaReference name="EditorCustomAttributes" version="01.00" prefix="beca" />
    <ECSchemaReference name="BisCore" version="01.00" prefix="bis" />
    <ECSchemaReference name="Functional" version="01.00" prefix="func" />
    <ECSchemaReference name="Grids" version="01.00" prefix="grids"/>
    <ECSchemaReference name="ECDbMap" version="2.0" prefix="ecdbmap"/>
    <ECSchemaReference name="AecUnits" version="01.00" prefix="AECU" />

    <ECRelationshipClass typeName="AllocatedVolumeDecomposesToElements" strength="embedding" modifier="None">
      <!-- Relationship that indicates a decomposition of child AllocatedVolume -->
      <Source multiplicity="(0..1)" roleLabel="composes of" polymorphic="true">
        <Class class="AllocatedVolume"/>
      </Source>
      <Target multiplicity="(0..*)" roleLabel="is part of" polymorphic="true">
        <Class class="AllocatedVolume"/>
      </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="BuildingDrivesSlicerInputsElement" strength="referencing">
      <BaseClass>bis:ElementDrivesElement</BaseClass>
      <ECCustomAttributes>
        <ClassHasHandler xmlns="BisCore.01.00"/>
      </ECCustomAttributes>
      <Source multiplicity="(0..1)" polymorphic="true">
        <Class class="Building"/>
      </Source>
      <Target multiplicity="(1..1)" polymorphic="true">
        <Class class="BuildingSlicerInputsBundle"/>
      </Target>
    </ECRelationshipClass>


    <ECRelationshipClass typeName="FloorPlaneDrivesSlicerInputsElement" strength="referencing">
      <BaseClass>bis:ElementDrivesElement</BaseClass>
      <ECCustomAttributes>
        <ClassHasHandler xmlns="BisCore.01.00"/>
      </ECCustomAttributes>
      <Source multiplicity="(0..N)" polymorphic="true">
        <Class class="grids:GridPlanarSurface"/>
      </Source>
      <Target multiplicity="(1..1)" polymorphic="true">
        <Class class="BuildingSlicerInputsBundle"/>
      </Target>
    </ECRelationshipClass>


    <ECRelationshipClass typeName="BuildingSlicerInputsDrivesBuildingSlicerOutputs" strength="referencing">
      <BaseClass>bis:ElementDrivesElement</BaseClass>
      <ECCustomAttributes>
        <ClassHasHandler xmlns="BisCore.01.00"/>
      </ECCustomAttributes>
      <Source multiplicity="(1..1)" polymorphic="true">
        <Class class="BuildingSlicerInputsBundle"/>
      </Source>
      <Target multiplicity="(1..1)" polymorphic="true">
        <Class class="BuildingSlicerOutputsBundle"/>
      </Target>
    </ECRelationshipClass>


    <ECRelationshipClass typeName="BuildingSlicerOutputsBundleCreatesStory" strength="referencing">
      <BaseClass>bis:ElementDrivesElement</BaseClass>
      <ECCustomAttributes>
        <ClassHasHandler xmlns="BisCore.01.00"/>
      </ECCustomAttributes>
      <Source multiplicity="(1..1)" polymorphic="true">
        <Class class="BuildingSlicerOutputsBundle"/>
      </Source>
      <Target multiplicity="(0..N)" polymorphic="true">
        <Class class="Story"/>
      </Target>
    </ECRelationshipClass>

    <ECEntityClass typeName="BuildingSlicerInputsBundle" displayLabel="building slicer inputs collector">
      <BaseClass>bis:DriverBundleElement</BaseClass>
      <ECCustomAttributes>
        <ClassHasHandler xmlns="BisCore.01.00" />
      </ECCustomAttributes>
    </ECEntityClass>


    <ECEntityClass typeName="BuildingSlicerOutputsBundle" displayLabel="building slicer outputs proxy">
      <BaseClass>bis:DriverBundleElement</BaseClass>
      <ECCustomAttributes>
        <ClassHasHandler xmlns="BisCore.01.00" />
      </ECCustomAttributes>
    </ECEntityClass>

    <ECEntityClass typeName="GridCurvePortion">
      <BaseClass>bis:SpatialLocationPortion</BaseClass>
      <ECCustomAttributes>
        <ClassHasHandler xmlns="BisCore.01.00" />
      </ECCustomAttributes>
    </ECEntityClass>
    
    <ECEntityClass typeName="Building" displayLabel="Building">
        <BaseClass>AllocatedVolume</BaseClass>
        <BaseClass>bis:ISubModeledElement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00" />
        </ECCustomAttributes>
    </ECEntityClass>

    <!--Mirrored Program Manager geometric elements start-->
    <ECEntityClass typeName="AllocatedVolume">
        <BaseClass>bis:SpatialLocationElement</BaseClass>
        <BaseClass>IAllocation</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00" />
        </ECCustomAttributes>
        <ECProperty propertyName="Name" displayLabel="Name" typeName="string"/>
        <ECProperty propertyName="Cost" displayLabel="Cost" typeName="double"/>
        <ECProperty propertyName="Occupancy" displayLabel="Occupancy" typeName="int"/>
        <ECNavigationProperty propertyName="ComposedElement" relationshipName="AllocatedVolumeDecomposesToElements" direction="Backward" description="The composed Element" />
    </ECEntityClass>

    <ECEnumeration typeName="ConflictVolumeType" backingTypeName="int" isStrict="true">
        <ECEnumerator value="0" displayLabel="Undefined"/>
        <ECEnumerator value="1" displayLabel="Missing Owner"/>
        <ECEnumerator value="2" displayLabel="Multiple Equal Owners"/>
        <ECEnumerator value="3" displayLabel="Multiple Unequal Owners"/>
    </ECEnumeration>

    <ECEntityClass typeName="ConflictVolume" displayLabel="ConflictVolume">
        <BaseClass>bis:SpatialLocationElement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00" />
        </ECCustomAttributes>
        <ECProperty propertyName="Type" typeName="ConflictVolumeType"/>
    </ECEntityClass>

    <ECEntityClass typeName="OpeningLocation" displayLabel="OpeningLocation">
        <BaseClass>bis:SpatialLocationElement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00" />
        </ECCustomAttributes>
        <ECProperty propertyName="Width" displayLabel="Width" typeName="double" kindOfQuantity="AECU:LENGTH"/>
        <ECProperty propertyName="IsEgress" distplayLabel="IsEgress" typeName ="boolean"/>
    </ECEntityClass>
  
    <ECEntityClass typeName="Story" displayLabel="Story">
      <BaseClass>AllocatedVolume</BaseClass>
      <BaseClass>bis:ISubModeledElement</BaseClass>
      <ECCustomAttributes>
        <ClassHasHandler xmlns="BisCore.01.00" />
      </ECCustomAttributes>
    </ECEntityClass>
    <ECEntityClass typeName="Space" displayLabel="Space">
        <BaseClass>AllocatedVolume</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00" />
        </ECCustomAttributes>
    </ECEntityClass>
    
    <ECEntityClass typeName="BubbleAspect">
        <BaseClass>bis:ElementUniqueAspect</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>
        <ECProperty propertyName="Radius" typeName="double" kindOfQuantity="AECU:LENGTH"/>
        <ECProperty propertyName="TargetArea" typeName="double" kindOfQuantity="AECU:AREA"/>
    </ECEntityClass>
  
    <ECRelationshipClass typeName="SpaceHasAdjacentSpaces" strength="referencing">
      <BaseClass>bis:ElementRefersToElements</BaseClass>
        <Source cardinality="(0,N)" polymorphic="false">
            <Class class="Space"/>
        </Source>
        <Target cardinality="(0,N)" polymorphic="false">
            <Class class="Space"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="AllocatedVolumeContains" strength="referencing">
      <BaseClass>bis:ElementRefersToElements</BaseClass>
        <Source cardinality="(0,N)" polymorphic="false">
            <Class class="Space"/>
        </Source>
        <Target cardinality="(0,N)" polymorphic="false">
            <Class class="bis:SpatialElement"/>
        </Target>
    </ECRelationshipClass>
    
    <ECRelationshipClass typeName="SpaceHasOpeningLocations" strength="referencing">
      <BaseClass>bis:ElementRefersToElements</BaseClass>
        <Source cardinality="(0,N)" polymorphic="false">
            <Class class="Space"/>
        </Source>
        <Target cardinality="(0,N)" polymorphic="false">
            <Class class="OpeningLocation"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="SpatialStoryOpeningLocations" strength="referencing">
      <BaseClass>bis:ElementRefersToElements</BaseClass>
        <Source cardinality="(0,N)" polymorphic="false">
            <Class class="Story"/>
        </Source>
        <Target cardinality="(0,N)" polymorphic="false">
            <Class class="OpeningLocation"/>
        </Target>
    </ECRelationshipClass>

    <ECEntityClass typeName="IAllocation" modifier="Abstract" displayTitle="Allocation" Description="An interface that indicates that an element is an allocated requirement">
        <ECCustomAttributes>
            <IsMixin xmlns="CoreCustomAttributes.1.0">
                <AppliesToEntityClass>bis:Element</AppliesToEntityClass>
            </IsMixin>
        </ECCustomAttributes>
        <ECProperty propertyName="Area" displayLabel="Area" typeName="double" readOnly="true" kindOfQuantity="AECU:AREA"/>
    </ECEntityClass>
    
    <!--Anticipating BIS TYPECATALOG ENHANCEMENTS START-->

    <ECEntityClass typeName="FunctionalTypeLibraryModel" displayLabel="A collection of building types">
        <BaseClass>bis:DefinitionModel</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>
        <ECProperty propertyName="SourceUrl" displayLabel="Identifies the BIM that this library of scripts was copied from." typeName="string"/>
    </ECEntityClass>

    <ECEntityClass typeName="AllocationRequirementTypeCatalog">
        <BaseClass>bis:DefinitionElement</BaseClass>
        <BaseClass>bis:ISubModeledElement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>
        <ECProperty propertyName="SourceUrl" displayLabel="Identifies the BIM that this library of scripts was copied from." typeName="string"/>
    </ECEntityClass>

    <ECRelationshipClass typeName="FunctionalTypeLibraryModelBreaksDownAllocationRequirementCatalog" strength="embedding" strengthDirection="Backward">
        <BaseClass>bis:ModelModelsElement</BaseClass>
        <Source cardinality="(0,1)" polymorphic="true">
            <Class class="FunctionalTypeLibraryModel"/>
        </Source>
        <Target cardinality="(1,1)" polymorphic="true">
            <Class class="AllocationRequirementTypeCatalog" />
        </Target>
    </ECRelationshipClass>

    <!--Anticipating BIS TYPECATALOG ENHANCEMENTS END-->

    <!--Program Manager ECClasses START-->
    <ECEntityClass typeName="AllocationRequirementType">
        <BaseClass>func:FunctionalType</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>
        <ECProperty propertyName="OmniClass" displayLabel="OmniClass" typeName="string"/>
        <ECProperty propertyName="Cost" displayLabel="Cost" typeName="double"/>
    </ECEntityClass>

    <ECEntityClass typeName="BuildingRequirementType">
        <BaseClass>AllocationRequirementType</BaseClass>
         <ECCustomAttributes>
             <ClassHasHandler xmlns="BisCore.01.00"/>
         </ECCustomAttributes>
    </ECEntityClass>

    <ECEntityClass typeName="SpaceRequirementType">
        <BaseClass>AllocationRequirementType</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>
    </ECEntityClass>

    <ECEnumeration typeName="SpatialContextType" backingTypeName="int" isStrict="true">
        <ECEnumerator value="0" displayLabel="Exterior"/>
        <ECEnumerator value="1" displayLabel="Interior"/>
        <ECEnumerator value="2" displayLabel="Interior-Void"/>
        <ECEnumerator value="3" displayLabel="Interior-Plenum"/>
    </ECEnumeration>

    <ECEntityClass typeName="SpatialContext">
        <BaseClass>bis:ElementUniqueAspect</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>
        <ECProperty propertyName="Context" typeName="SpatialContextType"/>
    </ECEntityClass>

    <!--Mirrored Program Manager geometric elements end-->
    <ECEntityClass typeName="AllocationRequirement" displayLabel="Allocation Requirement" modifier="Abstract">
        <BaseClass>func:FunctionalBreakdownElement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>

        <ECProperty propertyName="Name" displayLabel="Name" typeName="string"/>
        <ECProperty propertyName="Area" displayLabel="Area" typeName="double" kindOfQuantity="AECU:AREA"/>
        <ECProperty propertyName="Cost" displayLabel="Cost" typeName="double"/>
        <ECProperty propertyName="Occupancy" displayLabel="Occupancy" typeName="double"/>
        <ECProperty propertyName="Quantity" displayLabel="Quantity" typeName="int"/>

        <ECNavigationProperty propertyName="ParentRequirement" relationshipName="AllocationRequirementConnections"
                              direction="Backward" description="Parent allocation requirement" />
    </ECEntityClass>

    <ECRelationshipClass typeName="AllocationRequirementIsOfAllocationRequirementType" strength="referencing">
        <BaseClass>bis:ElementRefersToElements</BaseClass>
        <Source cardinality="(0,N)" polymorphic="true">
            <Class class="AllocationRequirement" />
        </Source>
        <Target cardinality="(0,N)" polymorphic="true">
            <Class class="AllocationRequirementType"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="SpaceRequirementTypeIsRelevantForBuildingRequirementTypes" strength="referencing">
      <BaseClass>bis:ElementRefersToElements</BaseClass>
      <Source cardinality="(0,N)" polymorphic="true">
        <Class class="SpaceRequirementType" />
      </Source>
      <Target cardinality="(0,N)" polymorphic="true">
        <Class class="BuildingRequirementType"/>
      </Target>
    </ECRelationshipClass>

    <ECEntityClass typeName="BuildingRequirement" displayLabel="Building">
        <BaseClass>AllocationRequirement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>
    </ECEntityClass>
    <ECEntityClass typeName="StoryRequirement" displayLabel="Story Requirement">
        <BaseClass>AllocationRequirement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>
    </ECEntityClass>
    <ECEntityClass typeName="ZoneRequirement" displayLabel="Zone Requirement">
        <BaseClass>AllocationRequirement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>
    </ECEntityClass>
    <ECEntityClass typeName="SpaceRequirement" displayLabel="Space Requirement">
        <BaseClass>AllocationRequirement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.01.00"/>
        </ECCustomAttributes>
    </ECEntityClass>

    <ECRelationshipClass typeName="AllocationRequirementConnections" strength="referencing">
        <Source multiplicity="(0..*)" polymorphic="true">
            <Class class="AllocationRequirement"/>
        </Source>
        <Target multiplicity="(0..1)" polymorphic="true">
            <Class class="AllocationRequirement"/>
        </Target>
    </ECRelationshipClass>
    
    <ECRelationshipClass typeName="AllocationRequirementDefinesAllocatedVolume" strength="referencing">
        <BaseClass>bis:ElementRefersToElements</BaseClass>
        <Source cardinality="(0,N)" polymorphic="true">
            <Class class="AllocationRequirement"/>
        </Source>
        <Target cardinality="(0,N)" polymorphic="true">
            <Class class="AllocatedVolume"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="SpaceToGridSurfaceConnections" strength="referencing">
      <BaseClass>bis:ElementRefersToElements</BaseClass>
        <Source cardinality="(0,N)" polymorphic="true">
            <Class class="Space"/>
        </Source>
        <Target cardinality="(0,N)" polymorphic="true">
            <Class class="grids:GridSurface"/>
        </Target>
    </ECRelationshipClass>

    <!--Program Manager ECClasses END-->   

</ECSchema>
